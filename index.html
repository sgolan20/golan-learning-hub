<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מרכז הלמידה</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <!-- סרגל צד קומפקטי -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="logo-shahar.png" alt="שחר גולן - קורסים, הדרכות, סדנאות AI" class="sidebar-logo">
            <h1>מרכז הלמידה</h1>
            <button class="toggle-sidebar" id="toggleSidebar">◀</button>
        </div>

        <div class="sidebar-content">
            <!-- חיפוש -->
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="חיפוש...">
            </div>

            <!-- רשימת נושאים -->
            <nav class="topics-nav" id="topicsNav">
                <!-- הנושאים יטענו דינמית -->
            </nav>
        </div>

        <!-- כפתור מצב עריכה -->
        <div class="sidebar-footer">
            <button class="edit-mode-btn" id="editModeBtn">
                <span class="icon">✏️</span>
                <span class="text">מצב עריכה</span>
            </button>
        </div>
    </aside>

    <!-- כפתור המבורגר למובייל -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="תפריט">
        <span class="hamburger-icon">
            <span></span>
            <span></span>
            <span></span>
        </span>
    </button>

    <!-- Overlay למובייל -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- אזור תוכן ראשי -->
    <main class="main-content" id="mainContent">
        <div class="content-header">
            <div class="breadcrumb" id="breadcrumb">
                <span>בית</span>
            </div>
            <div class="actions">
                <button class="btn btn-qr" id="showQrBtn" title="הצג QR Code">
                    <span class="icon">◫</span>
                    <span class="text">QR</span>
                </button>
                <button class="btn btn-copy" id="copyLinkBtn" title="העתק קישור">
                    <span class="icon">🔗</span>
                    <span class="text">העתק</span>
                </button>
                <button class="btn btn-print" id="printPageBtn" title="הדפס דף">
                    <span class="icon">🖨️</span>
                    <span class="text">הדפסה</span>
                </button>
            </div>
        </div>

        <div class="content-area" id="contentArea">
            <!-- תוכן ברירת מחדל -->
            <div class="welcome-screen">
                <h2>ברוכים הבאים למרכז הלמידה</h2>
                <p>בחר נושא מהתפריט כדי להתחיל</p>
                <div class="stats">
                    <div class="stat">
                        <span class="stat-number" id="totalTopics">0</span>
                        <span class="stat-label">נושאים</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="totalPages">0</span>
                        <span class="stat-label">דפים</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- מודל QR Code -->
    <div class="modal" id="qrModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>QR Code לדף הנוכחי</h3>
                <button class="close-modal" id="closeQrModal">×</button>
            </div>
            <div class="modal-body">
                <div id="qrCode"></div>
                <p class="qr-url" id="qrUrl"></p>
            </div>
        </div>
    </div>

    <!-- מודל תצוגה מקדימה להדפסה -->
    <div class="modal" id="printPreviewModal">
        <div class="modal-content print-preview-modal">
            <div class="modal-header">
                <h3>תצוגה מקדימה להדפסה</h3>
                <button class="close-modal" id="closePrintPreviewModal">×</button>
            </div>
            <div class="modal-body print-preview-body">
                <iframe id="printPreviewFrame" class="print-preview-iframe"></iframe>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPrintBtn">ביטול</button>
                <button class="btn btn-primary" id="confirmPrintBtn">הדפס</button>
            </div>
        </div>
    </div>

    <!-- מודל עריכת קורס -->
    <div class="modal" id="editCourseModal">
        <div class="modal-content edit-modal">
            <div class="modal-header">
                <h3 id="editCourseTitle">עריכת קורס</h3>
                <button class="close-modal" id="closeEditCourseModal">×</button>
            </div>
            <div class="modal-body">
                <form id="editCourseForm">
                    <input type="hidden" id="editCourseId">
                    <div class="form-group">
                        <label for="courseName">שם הקורס</label>
                        <input type="text" id="courseName" required>
                    </div>
                    <div class="form-group">
                        <label for="courseIcon">אייקון</label>
                        <input type="text" id="courseIcon" placeholder="🤖">
                    </div>
                    <div class="form-group">
                        <label for="courseDescription">תיאור</label>
                        <textarea id="courseDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="courseColor">צבע</label>
                        <input type="color" id="courseColor" value="#8b5cf6">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditCourse">ביטול</button>
                <button class="btn btn-danger" id="deleteCourseBtn" style="display:none;">מחיקה</button>
                <button class="btn btn-primary" id="saveCourseBtn">שמירה</button>
            </div>
        </div>
    </div>

    <!-- מודל עריכת נושא -->
    <div class="modal" id="editTopicModal">
        <div class="modal-content edit-modal">
            <div class="modal-header">
                <h3 id="editTopicTitle">עריכת נושא</h3>
                <button class="close-modal" id="closeEditTopicModal">×</button>
            </div>
            <div class="modal-body">
                <form id="editTopicForm">
                    <input type="hidden" id="editTopicId">
                    <input type="hidden" id="editTopicCourseId">
                    <div class="form-group">
                        <label for="topicName">שם הנושא</label>
                        <input type="text" id="topicName" required>
                    </div>
                    <div class="form-group">
                        <label for="topicIcon">אייקון</label>
                        <input type="text" id="topicIcon" placeholder="📖">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditTopic">ביטול</button>
                <button class="btn btn-danger" id="deleteTopicBtn" style="display:none;">מחיקה</button>
                <button class="btn btn-primary" id="saveTopicBtn">שמירה</button>
            </div>
        </div>
    </div>

    <!-- מודל עריכת שיעור -->
    <div class="modal" id="editPageModal">
        <div class="modal-content edit-modal">
            <div class="modal-header">
                <h3 id="editPageTitle">עריכת שיעור</h3>
                <button class="close-modal" id="closeEditPageModal">×</button>
            </div>
            <div class="modal-body">
                <form id="editPageForm">
                    <input type="hidden" id="editPageId">
                    <input type="hidden" id="editPageCourseId">
                    <input type="hidden" id="editPageTopicId">
                    <div class="form-group">
                        <label for="pageTitle">כותרת השיעור</label>
                        <input type="text" id="pageTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="pageFile">קובץ HTML (אופציונלי)</label>
                        <input type="text" id="pageFile" placeholder="pages/lesson.html">
                    </div>
                    <div class="form-group">
                        <label for="pageContent">תוכן (אם אין קובץ)</label>
                        <div class="visual-editor-wrapper">
                            <div class="visual-editor-toolbar" id="visualEditorToolbar">
                                <button type="button" class="toolbar-btn" data-command="bold" title="מודגש">
                                    <strong>B</strong>
                                </button>
                                <button type="button" class="toolbar-btn" data-command="italic" title="נטוי">
                                    <em>I</em>
                                </button>
                                <button type="button" class="toolbar-btn" data-command="underline" title="קו תחתון">
                                    <u>U</u>
                                </button>
                                <div class="toolbar-separator"></div>
                                <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h2" title="כותרת 2">
                                    H2
                                </button>
                                <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h3" title="כותרת 3">
                                    H3
                                </button>
                                <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="p" title="פסקה">
                                    P
                                </button>
                                <div class="toolbar-separator"></div>
                                <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="רשימה לא מסודרת">
                                    • רשימה
                                </button>
                                <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="רשימה מסודרת">
                                    1. רשימה
                                </button>
                                <div class="toolbar-separator"></div>
                                <button type="button" class="toolbar-btn" data-command="createLink" title="הוסף קישור">
                                    🔗 קישור
                                </button>
                                <button type="button" class="toolbar-btn" data-command="insertImage" title="הוסף תמונה">
                                    🖼️ תמונה
                                </button>
                                <div class="toolbar-separator"></div>
                                <button type="button" class="toolbar-btn" data-command="code" title="קוד">
                                    &lt;/&gt;
                                </button>
                                <button type="button" class="toolbar-btn" data-command="removeFormat" title="הסר עיצוב">
                                    ✂️ הסר
                                </button>
                            </div>
                            <div class="visual-editor" id="pageContent" contenteditable="true" placeholder="כתוב כאן את תוכן השיעור..."></div>
                            <textarea id="pageContentHidden" style="display:none;"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditPage">ביטול</button>
                <button class="btn btn-danger" id="deletePageBtn" style="display:none;">מחיקה</button>
                <button class="btn btn-primary" id="savePageBtn">שמירה</button>
            </div>
        </div>
    </div>

    <!-- מודל ניהול נתונים -->
    <div class="modal" id="dataManagementModal">
        <div class="modal-content edit-modal">
            <div class="modal-header">
                <h3>ניהול נתונים</h3>
                <button class="close-modal" id="closeDataModal">×</button>
            </div>
            <div class="modal-body">
                <div class="data-actions">
                    <button class="btn btn-primary" id="exportDataBtn">
                        <span class="icon">📤</span>
                        ייצוא נתונים
                    </button>
                    <button class="btn btn-secondary" id="importDataBtn">
                        <span class="icon">📥</span>
                        ייבוא נתונים
                    </button>
                    <input type="file" id="importFileInput" accept=".json" style="display:none;">
                    <button class="btn btn-danger" id="resetDataBtn">
                        <span class="icon">🔄</span>
                        איפוס לברירת מחדל
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- הודעה קופצת -->
    <div class="toast" id="toast"></div>

    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
